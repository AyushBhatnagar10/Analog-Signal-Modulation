<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modulation Techniques Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
                /* Modern Typography */
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap');

        /* CSS Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .warning-indicator {
            position: absolute;
            right: 15px;
            top: 15px;
            color: #ef4444;
            font-size: 18px;
            font-weight: bold;
            cursor: help;
        }

        #parameter-guidance {
            background: linear-gradient(to bottom right, #fff9e6, #fff3cd);
            border-left: 4px solid #ffc107;
        }

        #parameter-guidance h3 {
            color: #856404;
        }
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3f37c9;
            --secondary: #f72585;
            --accent: #7209b7;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --transition: all 0.3s ease;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-100);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        /* Container & Layout */
        .container {
            max-width: 1100px;
            margin: 2rem auto;
            background: linear-gradient(to bottom right, #ffffff, #f8f9fa);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            position: relative;
        }

        .content-wrapper {
            padding: 2rem;
        }

        /* Header Styling */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 2.5rem 2rem;
            text-align: center;
            border-bottom: 5px solid var(--primary-dark);
            position: relative;
        }

        .header h1 {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            letter-spacing: -0.025em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-weight: 400;
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Controls Section */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background-color: var(--gray-50);
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-200);
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        .control-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.95rem;
        }

        .control-group select,
        .control-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            background-color: white;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.25);
        }

        .control-group select {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236b7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1.25rem;
            padding-right: 2.5rem;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .control-group span {
            display: block;
            text-align: right;
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: var(--gray-600);
            font-variant-numeric: tabular-nums;
        }

        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            background: linear-gradient(to right, var(--primary-light), var(--primary));
            border-radius: 8px;
            cursor: pointer;
            margin-top: 0.5rem;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        /* Buttons */
        .buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        button {
            padding: 0.75rem 1.75rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
            border: none;
            box-shadow: var(--shadow);
            letter-spacing: 0.01em;
        }

        #play-pause {
            background-color: var(--primary);
            color: white;
            position: relative;
            padding-left: 2.25rem;
        }

        #play-pause:before {
            content: "▶";
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.875rem;
        }

        #play-pause.playing:before {
            content: "⏸";
        }

        #play-pause:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        #reset {
            background-color: var(--gray-200);
            color: var(--gray-700);
            position: relative;
            padding-left: 2.25rem;
        }

        #reset:before {
            content: "↺";
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.125rem;
        }

        #reset:hover {
            background-color: var(--gray-300);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Canvas Containers */
        .canvas-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .canvas-wrapper {
            background-color: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid var(--gray-200);
        }

        .canvas-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background-color: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
        }

        .canvas-header h3 {
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            color: var(--gray-800);
            font-size: 1.125rem;
            margin: 0;
        }

        .canvas-header .info-icon {
            color: var(--gray-400);
            cursor: help;
            transition: var(--transition);
        }

        .canvas-header .info-icon:hover {
            color: var(--primary);
        }

        canvas {
            width: 100%;
            height: 300px;
            display: block;
            background-color: var(--gray-50);
            border-radius: 0 0 8px 8px;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin: 1.5rem 0;
            padding: 1rem;
            background-color: var(--gray-50);
            border-radius: 8px;
            border: 1px solid var(--gray-200);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: white;
            border-radius: 6px;
            box-shadow: var(--shadow-sm);
        }

        .color-box {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .legend-item span {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--gray-700);
        }

        /* Explanation Section */
        .explanation {
            background: linear-gradient(to bottom right, #e8f4f8, #f0f7fa);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid var(--primary-light);
            margin-top: 2rem;
            box-shadow: var(--shadow);
        }

        .explanation h3 {
            font-family: 'Outfit', sans-serif;
            color: var(--primary-dark);
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .explanation p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .explanation p:last-child {
            margin-bottom: 0;
        }

        .explanation strong {
            color: var(--primary-dark);
            font-weight: 600;
        }

        /* Footer */
        footer {
            margin-top: 3rem;
            padding: 2rem 0;
            background: linear-gradient(135deg, var(--gray-800), var(--gray-900));
            color: white;
            text-align: center;
            border-top: 5px solid var(--primary);
        }

        .footer-content {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        footer p {
            margin: 0.5rem 0;
            opacity: 0.9;
        }

        .heart {
            color: var(--secondary);
            display: inline-block;
            animation: heartbeat 1.5s infinite;
            font-size: 1.2em;
        }

        .authors {
            font-family: 'Outfit', sans-serif;
            font-weight: 500;
            font-size: 1.1em;
            margin-top: 1rem;
            letter-spacing: 0.01em;
        }

        .separator {
            margin: 0 0.75rem;
            color: var(--gray-500);
            opacity: 0.6;
        }

        /* Signal Colors */
        .message-signal {
            color: var(--success);
        }

        .carrier-signal {
            color: var(--primary);
        }

        .modulated-signal {
            color: var(--danger);
        }

        /* Animation */
        @keyframes heartbeat {
            0% { transform: scale(1); }
            5% { transform: scale(1.2); }
            10% { transform: scale(1); }
            15% { transform: scale(1.2); }
            20% { transform: scale(1); }
            100% { transform: scale(1); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 2rem 1.5rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .content-wrapper {
                padding: 1.5rem;
            }
            
            .control-group {
                min-width: 100%;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }

        /* Transitions & Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Add hover effects for interactive elements */
        .canvas-wrapper:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
            transition: var(--transition);
        }
    </style>

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Signal Modulation Simulator</h1>
            <p>Interactive visualization of AM, FM, and PM modulation techniques</p>
        </div>
        
        <div class="content-wrapper">
            <div class="controls">
                <div class="control-group">
                    <label for="modulation-type">Modulation Type:</label>
                    <select id="modulation-type">
                        <option value="am">Amplitude Modulation (AM)</option>
                        <option value="fm">Frequency Modulation (FM)</option>
                        <option value="pm">Phase Modulation (PM)</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="carrier-amplitude">Carrier Amplitude (Ac):</label>
                    <input type="range" id="carrier-amplitude" min="0.5" max="1" value="1" step="0.1">
                    <span id="carrier-amplitude-value">1.0</span>
                </div>
                
                <div class="control-group">
                    <label for="message-amplitude">Message Amplitude (Am):</label>
                    <input type="range" id="message-amplitude" min="0.1" max="1" value="0.5" step="0.1">
                    <span id="message-amplitude-value">0.5</span>
                </div>
                
                <div class="control-group">
                    <label for="carrier-frequency">Carrier Frequency (fc):</label>
                    <input type="range" id="carrier-frequency" min="0.1" max="15" value="10" step="1">
                    <span id="carrier-frequency-value">10 Hz</span>
                </div>
                
                <div class="control-group">
                    <label for="message-frequency">Message Frequency (fm):</label>
                    <input type="range" id="message-frequency" min="0.1" max="15" value="1" step="0.5">
                    <span id="message-frequency-value">1 Hz</span>
                </div>
                
                <div class="control-group">
                    <label for="kf-value">FM Sensitivity (Kf):</label>
                    <input type="range" id="kf-value" min="0.5" max="5" value="2" step="0.5">
                    <span id="kf-value-value">2.0</span>
                </div>
                
                <div class="control-group">
                    <label for="kp-value">PM Sensitivity (Kp):</label>
                    <input type="range" id="kp-value" min="0.5" max="5" value="2" step="0.5">
                    <span id="kp-value-value">2.0</span>
                </div>
            </div>
            
            <div class="buttons">
                <button id="play-pause">Start Simulation</button>
                <button id="reset">Reset</button>
            </div>
        
            <div class="canvas-container">
                <div class="canvas-wrapper fade-in">
                    <div class="canvas-header">
                        <h3>Message Signal</h3>
                        <span class="info-icon" title="Input signal to be modulated">ⓘ</span>
                    </div>
                    <canvas id="message-canvas"></canvas>
                </div>
                
                <div class="canvas-wrapper fade-in">
                    <div class="canvas-header">
                        <h3>Carrier Signal</h3>
                        <span class="info-icon" title="High frequency signal used for transmission">ⓘ</span>
                    </div>
                    <canvas id="carrier-canvas"></canvas>
                </div>
                
                <div class="canvas-wrapper fade-in">
                    <div class="canvas-header">
                        <h3>Modulated Signal</h3>
                        <span class="info-icon" title="Result of modulation process">ⓘ</span>
                    </div>
                    <canvas id="modulated-canvas"></canvas>
                </div>
            </div>
        
            <div class="legend">
                <div class="legend-item">
                    <div class="color-box" style="background-color: #10b981;"></div>
                    <span>Message Signal</span>
                </div>
                <div class="legend-item">
                    <div class="color-box" style="background-color: #4361ee;"></div>
                    <span>Carrier Signal</span>
                </div>
                <div class="legend-item">
                    <div class="color-box" style="background-color: #ef4444;"></div>
                    <span>Modulated Signal</span>
                </div>
            </div>
            
            <div class="explanation" id="explanation">
                <h3>Amplitude Modulation (AM)</h3>
                <p>Amplitude Modulation changes the <strong>amplitude (height)</strong> of the carrier wave according to the message signal. The AM equation used is:</p>
                <p><strong>x<sub>AM</sub>(t) = A<sub>c</sub> × (1 + μ × cos(2π × f<sub>m</sub> × t)) × cos(2π × f<sub>c</sub> × t)</strong></p>
                <p>where μ = A<sub>m</sub>/A<sub>c</sub> is the modulation index.</p>
            </div>
        </div>
    </div>

    <script>
        // Get all the HTML elements
        const modulationType = document.getElementById('modulation-type');
        const carrierAmplitudeSlider = document.getElementById('carrier-amplitude');
        const carrierAmplitudeValue = document.getElementById('carrier-amplitude-value');
        const messageAmplitudeSlider = document.getElementById('message-amplitude');
        const messageAmplitudeValue = document.getElementById('message-amplitude-value');
        const carrierFrequencySlider = document.getElementById('carrier-frequency');
        const carrierFrequencyValue = document.getElementById('carrier-frequency-value');
        const messageFrequencySlider = document.getElementById('message-frequency');
        const messageFrequencyValue = document.getElementById('message-frequency-value');
        const kfValueSlider = document.getElementById('kf-value');
        const kfValueValue = document.getElementById('kf-value-value');
        const kpValueSlider = document.getElementById('kp-value');
        const kpValueValue = document.getElementById('kp-value-value');
        const playPauseButton = document.getElementById('play-pause');
        const resetButton = document.getElementById('reset');
        const explanationDiv = document.getElementById('explanation');

        // Get the canvases and their contexts
        const messageCanvas = document.getElementById('message-canvas');
        const carrierCanvas = document.getElementById('carrier-canvas');
        const modulatedCanvas = document.getElementById('modulated-canvas');
        
        const messageCtx = messageCanvas.getContext('2d');
        const carrierCtx = carrierCanvas.getContext('2d');
        const modulatedCtx = modulatedCanvas.getContext('2d');

        // Set canvas dimensions
        const canvases = [messageCanvas, carrierCanvas, modulatedCanvas];
        canvases.forEach(canvas => {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        });

        // Variables for the animation
        let animationFrameId;
        let isPlaying = false;
        let time = 0;
        
        // Update the display values for sliders
        carrierAmplitudeSlider.addEventListener('input', () => {
            carrierAmplitudeValue.textContent = carrierAmplitudeSlider.value;
            if (isPlaying) draw();
        });
        
        messageAmplitudeSlider.addEventListener('input', () => {
            messageAmplitudeValue.textContent = messageAmplitudeSlider.value;
            if (isPlaying) draw();
        });
        
        carrierFrequencySlider.addEventListener('input', () => {
            carrierFrequencyValue.textContent = `${carrierFrequencySlider.value} Hz`;
            if (isPlaying) draw();
        });
        
        messageFrequencySlider.addEventListener('input', () => {
            messageFrequencyValue.textContent = `${messageFrequencySlider.value} Hz`;
            if (isPlaying) draw();
        });
        
        kfValueSlider.addEventListener('input', () => {
            kfValueValue.textContent = kfValueSlider.value;
            if (isPlaying) draw();
        });
        
        kpValueSlider.addEventListener('input', () => {
            kpValueValue.textContent = kpValueSlider.value;
            if (isPlaying) draw();
        });
        
        // Change explanation based on modulation type
        modulationType.addEventListener('change', () => {
            updateExplanation();
            addParameterGuidance();
            if (isPlaying) draw();
        });
        
        function addParameterGuidance() {
            // Create or update a div for parameter guidance
            let guidanceDiv = document.getElementById('parameter-guidance');
            
            if (!guidanceDiv) {
                guidanceDiv = document.createElement('div');
                guidanceDiv.id = 'parameter-guidance';
                guidanceDiv.className = 'explanation';
                guidanceDiv.style.marginTop = '1.5rem';
                
                // Insert after the existing explanation div
                const explanationDiv = document.getElementById('explanation');
                explanationDiv.parentNode.insertBefore(guidanceDiv, explanationDiv.nextSibling);
            }
            
            // Set content based on modulation type
            const modType = document.getElementById('modulation-type').value;
            let content = '';
            
            if (modType === 'am') {
                content = `
                    <h3>AM Parameter Guidelines</h3>
                    <p><strong>Carrier Amplitude (Ac):</strong> Should be larger than message amplitude for proper modulation. Recommended: 0.8-1.0</p>
                    <p><strong>Message Amplitude (Am):</strong> For AM, keep Am < Ac to prevent over-modulation. Ideal range: 0.1-0.7</p>
                    <p><strong>Carrier Frequency (fc):</strong> Should be significantly higher than message frequency. Recommended: fc ≥ 5 × fm</p>
                    <p><strong>Message Frequency (fm):</strong> Keep lower than carrier frequency. Recommended: 0.5-3.0 Hz</p>
                    <p><strong>Modulation Index (μ = Am/Ac):</strong> For proper AM, μ should be less than 1.0 to avoid over-modulation.</p>
                `;
            } else if (modType === 'fm') {
                content = `
                    <h3>FM Parameter Guidelines</h3>
                    <p><strong>Carrier Amplitude (Ac):</strong> Controls the overall amplitude of the modulated signal. Recommended: 0.7-1.0</p>
                    <p><strong>Message Amplitude (Am):</strong> Affects the modulation index together with Kf. Recommended: 0.3-0.7</p>
                    <p><strong>Carrier Frequency (fc):</strong> Should be significantly higher than message frequency. Recommended: fc ≥ 10 × fm</p>
                    <p><strong>Message Frequency (fm):</strong> Keep lower than carrier frequency. Recommended: 0.5-2.0 Hz</p>
                    <p><strong>FM Sensitivity (Kf):</strong> Controls how much the frequency changes. For clear visualization: 1.0-3.0</p>
                    <p><strong>Modulation Index (β = Kf×Am/fm):</strong> Values under 2.5 provide clearer visualization.</p>
                `;
            } else if (modType === 'pm') {
                content = `
                    <h3>PM Parameter Guidelines</h3>
                    <p><strong>Carrier Amplitude (Ac):</strong> Controls the overall amplitude of the modulated signal. Recommended: 0.7-1.0</p>
                    <p><strong>Message Amplitude (Am):</strong> Affects the phase deviation together with Kp. Recommended: 0.3-0.5</p>
                    <p><strong>Carrier Frequency (fc):</strong> Should be significantly higher than message frequency. Recommended: fc ≥ 8 × fm</p>
                    <p><strong>Message Frequency (fm):</strong> Keep lower than carrier frequency. Recommended: 0.5-2.0 Hz</p>
                    <p><strong>PM Sensitivity (Kp):</strong> Controls the amount of phase deviation. For clear visualization: 0.5-2.0</p>
                    <p><strong>Phase Deviation (Kp×Am):</strong> Values under 1.0 radians provide clearer visualization without AM-like artifacts.</p>
                `;
            }
            
            guidanceDiv.innerHTML = content;
        }
        // Update explanation function with the new formulas
        function updateExplanation() {
            const type = modulationType.value;
            let content = '';
            
            if (type === 'am') {
                content = `
                    <h3>Amplitude Modulation (AM)</h3>
                    <p>Amplitude Modulation changes the <strong>amplitude (height)</strong> of the carrier wave according to the message signal. The AM equation used is:</p>
                    <p><strong>x<sub>AM</sub>(t) = A<sub>c</sub> × (1 + μ × cos(2π × f<sub>m</sub> × t)) × cos(2π × f<sub>c</sub> × t)</strong></p>
                    <p>where μ = A<sub>m</sub>/A<sub>c</sub> is the modulation index.</p>
                `;
            } else if (type === 'fm') {
                content = `
                    <h3>Frequency Modulation (FM)</h3>
                    <p>Frequency Modulation changes the <strong>frequency (spacing between peaks)</strong> of the carrier wave according to the message signal. The FM equation used is:</p>
                    <p><strong>x<sub>FM</sub>(t) = A<sub>c</sub> × cos(2π × f<sub>c</sub> × t + β × sin(2π × f<sub>m</sub> × t))</strong></p>
                    <p>where β = (K<sub>f</sub> × A<sub>m</sub>)/f<sub>m</sub> is the modulation index.</p>
                    <p><strong>Note:</strong> In FM, the amplitude remains constant, but varying frequency can create visual patterns that may appear like amplitude variations.</p>
                `;
            } else if (type === 'pm') {
                content = `
                    <h3>Phase Modulation (PM)</h3>
                    <p>Phase Modulation changes the <strong>phase (timing offset)</strong> of the carrier wave according to the message signal. The PM equation used is:</p>
                    <p><strong>x<sub>PM</sub>(t) = A<sub>c</sub> × cos(2π × f<sub>c</sub> × t + K<sub>p</sub> × m(t))</strong></p>
                    <p>where m(t) = A<sub>m</sub> × cos(2π × f<sub>m</sub> × t) is the message signal.</p>
                    <p><strong>Note:</strong> In PM, the amplitude remains constant, but rapid phase changes can create visual patterns that may look like amplitude variations.</p>
                `;
            }
            
            explanationDiv.innerHTML = content;
            
            // Update parameter guidance when modulation type changes
            addParameterGuidance();
        }
        
        // Play/Pause button
        playPauseButton.addEventListener('click', () => {
            if (isPlaying) {
                cancelAnimationFrame(animationFrameId);
                playPauseButton.textContent = 'Start Simulation';
                playPauseButton.classList.remove('playing');
            } else {
                animate();
                playPauseButton.textContent = 'Pause Simulation';
                playPauseButton.classList.add('playing');
            }
            isPlaying = !isPlaying;
        });
        
        // Reset button
        resetButton.addEventListener('click', () => {
        time = 0;
        addParameterGuidance(); // Add this line
        if (isPlaying) {
            draw();
        } else {
            clearCanvases();
            drawInitialWaves();
        }
    });
        
        // Clear all canvases
        function clearCanvases() {
            canvases.forEach(canvas => {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            });
        }
        
        // Draw initial static waves
        function drawInitialWaves() {
            // Just show a placeholder for now
            canvases.forEach(canvas => {
                const ctx = canvas.getContext('2d');
                ctx.beginPath();
                ctx.moveTo(0, canvas.height / 2);
                ctx.lineTo(canvas.width, canvas.height / 2);
                ctx.strokeStyle = "#ddd";
                ctx.stroke();
                
                ctx.font = "14px Arial";
                ctx.fillStyle = "#888";
                ctx.textAlign = "center";
                ctx.fillText("Start the simulation to see the waveforms", canvas.width / 2, canvas.height / 2 - 15);
            });
        }
        
        // Animation function
        function animate() {
            animationFrameId = requestAnimationFrame(animate);
            draw();
            time += 0.01;
        }
        
        // Draw function to render all waveforms
        function draw() {
            clearCanvases();
            
            const carrierAmplitude = parseFloat(carrierAmplitudeSlider.value);
            const messageAmplitude = parseFloat(messageAmplitudeSlider.value);
            const carrierFrequency = parseFloat(carrierFrequencySlider.value);
            const messageFrequency = parseFloat(messageFrequencySlider.value);
            const kfValue = parseFloat(kfValueSlider.value);
            const kpValue = parseFloat(kpValueSlider.value);
            
            // Draw center lines
            canvases.forEach(canvas => {
                const ctx = canvas.getContext('2d');
                ctx.beginPath();
                ctx.moveTo(0, canvas.height / 2);
                ctx.lineTo(canvas.width, canvas.height / 2);
                ctx.strokeStyle = "#ddd";
                ctx.stroke();
            });
            
            // Draw message signal
            drawMessageSignal(messageCanvas, messageFrequency, messageAmplitude);
            
            // Draw carrier signal
            drawCarrierSignal(carrierCanvas, carrierFrequency, carrierAmplitude);
            
            // Draw modulated signal
            const modType = modulationType.value;
            if (modType === 'am') {
                drawAmModulatedSignal(modulatedCanvas, carrierFrequency, messageFrequency, carrierAmplitude, messageAmplitude);
            } else if (modType === 'fm') {
                drawFmModulatedSignal(modulatedCanvas, carrierFrequency, messageFrequency, carrierAmplitude, messageAmplitude, kfValue);
            } else if (modType === 'pm') {
                drawPmModulatedSignal(modulatedCanvas, carrierFrequency, messageFrequency, carrierAmplitude, messageAmplitude, kpValue);
            }
        }
        
        // Draw message signal
        function drawMessageSignal(canvas, frequency, amplitude) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const signalAmplitude = height * 0.4 * amplitude; // Scale by amplitude parameter
            
            ctx.beginPath();
            ctx.strokeStyle = "#10b981"; // Green color for message signal
            ctx.lineWidth = 2;
            
            for (let x = 0; x < width; x++) {
                const t = time + (x / width) * (Math.PI * 2);
                const y = height / 2 + signalAmplitude * Math.cos(frequency * t * 2 * Math.PI);
                
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
        }
        
        // Draw carrier signal
        function drawCarrierSignal(canvas, frequency, amplitude) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const signalAmplitude = height * 0.4 * amplitude; // Scale by amplitude parameter
            
            ctx.beginPath();
            ctx.strokeStyle = "#4361ee"; // Updated blue color for carrier signal
            ctx.lineWidth = 2;
            
            for (let x = 0; x < width; x++) {
                const t = time + (x / width) * (Math.PI * 2);
                const y = height / 2 + signalAmplitude * Math.cos(frequency * t * 2 * Math.PI);
                
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
        }
        
        // Draw AM modulated signal with updated formula
        function drawAmModulatedSignal(canvas, carrierFreq, messageFreq, carrierAmp, messageAmp) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const baseAmplitude = height * 0.4; // Base amplitude for visualization
            
            // Calculate modulation index μ = Am/Ac
            const modulationIndex = messageAmp / carrierAmp;
            
            ctx.beginPath();
            ctx.strokeStyle = "#ef4444"; // Red color for modulated signal
            ctx.lineWidth = 2;
            
            for (let x = 0; x < width; x++) {
                const t = time + (x / width) * (Math.PI * 2);
                
                // Updated AM formula: Ac * (1 + μ * cos(2πfmt)) * cos(2πfct)
                const message = Math.cos(messageFreq * t * 2 * Math.PI);
                const carrier = Math.cos(carrierFreq * t * 2 * Math.PI);
                const y = height / 2 + baseAmplitude * carrierAmp * (1 + modulationIndex * message) * carrier;
                
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            // Draw envelope
            ctx.beginPath();
            ctx.strokeStyle = "rgba(255, 0, 0, 0.3)";
            ctx.lineWidth = 1;
            
            for (let x = 0; x < width; x++) {
                const t = time + (x / width) * (Math.PI * 2);
                const message = Math.cos(messageFreq * t * 2 * Math.PI);
                const envelope = height / 2 + baseAmplitude * carrierAmp * (1 + modulationIndex * message);
                
                if (x === 0) {
                    ctx.moveTo(x, envelope);
                } else {
                    ctx.lineTo(x, envelope);
                }
            }
            
            ctx.stroke();
            
            ctx.beginPath();
            ctx.strokeStyle = "rgba(255, 0, 0, 0.3)";
            
            for (let x = 0; x < width; x++) {
                const t = time + (x / width) * (Math.PI * 2);
                const message = Math.cos(messageFreq * t * 2 * Math.PI);
                const envelope = height / 2 - baseAmplitude * carrierAmp * (1 + modulationIndex * message);
                
                if (x === 0) {
                    ctx.moveTo(x, envelope);
                } else {
                    ctx.lineTo(x, envelope);
                }
            }
            
            ctx.stroke();
        }
        
        // Draw FM modulated signal with updated formula including Kf
        function drawFmModulatedSignal(canvas, carrierFreq, messageFreq, carrierAmp, messageAmp, kfValue) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const baseAmplitude = height * 0.4; // Base amplitude for visualization
            
            // Calculate beta = (Kf * Am) / fm according to the given formula
            const beta = (kfValue * messageAmp) / messageFreq;
            
            // Draw constant amplitude envelope to emphasize that amplitude doesn't change
            ctx.beginPath();
            ctx.strokeStyle = "rgba(255, 0, 0, 0.2)";
            ctx.setLineDash([5, 3]);
            ctx.lineWidth = 1;
            
            // Upper envelope line
            ctx.moveTo(0, height/2 - baseAmplitude * carrierAmp);
            ctx.lineTo(width, height/2 - baseAmplitude * carrierAmp);
            
            // Lower envelope line
            ctx.moveTo(0, height/2 + baseAmplitude * carrierAmp);
            ctx.lineTo(width, height/2 + baseAmplitude * carrierAmp);
            
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw the actual FM signal
            ctx.beginPath();
            ctx.strokeStyle = "#ef4444"; // Red color for modulated signal
            ctx.lineWidth = 2;
            
            for (let x = 0; x < width; x++) {
                const t = time + (x / width) * (Math.PI * 2);
                
                // FM formula: Ac * cos(2πfct + β * sin(2πfmt))
                const message = Math.sin(messageFreq * t * 2 * Math.PI);
                const phase = carrierFreq * t * 2 * Math.PI + beta * message;
                const y = height / 2 + baseAmplitude * carrierAmp * Math.cos(phase);
                
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            // Add FM information and warnings
            ctx.font = "12px Inter";
            ctx.fillStyle = "#374151";
            ctx.fillText(`Modulation Index (β) = ${beta.toFixed(2)}`, 15, 20);
            
            // Visual indicators and warnings
            if (beta > 2.5) {
                // Warning for high modulation index
                ctx.fillStyle = "#ef4444";
                ctx.fillRect(10, height - 45, width - 20, 30);
                ctx.fillStyle = "white";
                ctx.font = "12px Inter";
                ctx.textAlign = "center";
                ctx.fillText("High modulation index (β > 2.5) may create visual artifacts", width/2, height - 30);
                ctx.textAlign = "left";
            }
            
            if (carrierFreq < messageFreq * 10) {
                // Warning for carrier frequency being too close to message frequency
                ctx.fillStyle = "#f59e0b";
                ctx.fillRect(10, height - 75, width - 20, 25);
                ctx.fillStyle = "white";
                ctx.font = "12px Inter";
                ctx.textAlign = "center";
                ctx.fillText("For better FM visualization, use fc ≥ 10 × fm", width/2, height - 60);
                ctx.textAlign = "left";
            }
        }

        // Draw PM modulated signal with improved visualization and warnings
        function drawPmModulatedSignal(canvas, carrierFreq, messageFreq, carrierAmp, messageAmp, kpValue) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const baseAmplitude = height * 0.4; // Base amplitude for visualization
            
            // Calculate modulation index for PM
            const phaseDeviation = kpValue * messageAmp;
            
            // Draw constant amplitude envelope to emphasize that amplitude doesn't change
            ctx.beginPath();
            ctx.strokeStyle = "rgba(255, 0, 0, 0.2)";
            ctx.setLineDash([5, 3]);
            ctx.lineWidth = 1;
            
            // Upper envelope line
            ctx.moveTo(0, height/2 - baseAmplitude * carrierAmp);
            ctx.lineTo(width, height/2 - baseAmplitude * carrierAmp);
            
            // Lower envelope line
            ctx.moveTo(0, height/2 + baseAmplitude * carrierAmp);
            ctx.lineTo(width, height/2 + baseAmplitude * carrierAmp);
            
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw the actual PM signal
            ctx.beginPath();
            ctx.strokeStyle = "#ef4444"; // Red color for modulated signal
            ctx.lineWidth = 2;
            
            for (let x = 0; x < width; x++) {
                const t = time + (x / width) * (Math.PI * 2);
                
                // PM formula: Ac * cos(2πfct + Kp * m(t))
                // Where m(t) = Am * cos(2πfmt)
                const message = messageAmp * Math.cos(messageFreq * t * 2 * Math.PI);
                const phase = carrierFreq * t * 2 * Math.PI + kpValue * message;
                const y = height / 2 + baseAmplitude * carrierAmp * Math.cos(phase);
                
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            // Add PM information and warnings
            ctx.font = "12px Inter";
            ctx.fillStyle = "#374151";
            ctx.fillText(`Phase Deviation = ${phaseDeviation.toFixed(2)} radians`, 15, 20);
            
            // Visual indicators and warnings
            if (phaseDeviation > 1.0) {
                // Warning for high phase deviation
                ctx.fillStyle = "#ef4444";
                ctx.fillRect(10, height - 45, width - 20, 30);
                ctx.fillStyle = "white";
                ctx.font = "12px Inter";
                ctx.textAlign = "center";
                ctx.fillText("High phase deviation may create visual artifacts that look like AM", width/2, height - 30);
                ctx.textAlign = "left";
            }
            
            if (carrierFreq < messageFreq * 8) {
                // Warning for carrier frequency being too close to message frequency
                ctx.fillStyle = "#f59e0b";
                ctx.fillRect(10, height - 75, width - 20, 25);
                ctx.fillStyle = "white";
                ctx.font = "12px Inter";
                ctx.textAlign = "center";
                ctx.fillText("For better PM visualization, use fc ≥ 8 × fm", width/2, height - 60);
                ctx.textAlign = "left";
            }
        }
        
        // Initialize the application
        updateExplanation();
        drawInitialWaves();
        
        // Handle window resize
        window.addEventListener('resize', () => {
            canvases.forEach(canvas => {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            });
            
            if (isPlaying) {
                draw();
            } else {
                clearCanvases();
                drawInitialWaves();
            }
        });
    </script>
    <footer>
        <div class="footer-content">
            <p>Made with <span class="heart">❤️</span> by:</p>
            <p class="authors">
                <span>Ayush Bhatnagar (23BTM007)</span>
                <span class="separator">|</span>
                <span>Jenil Buha (23BCE039)</span>
            </p>
        </div>
    </footer>
</body>
</html>